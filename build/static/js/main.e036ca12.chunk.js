(this["webpackJsonptutorial-react-version"]=this["webpackJsonptutorial-react-version"]||[]).push([[0],{29:function(e,t,a){e.exports=a(59)},3:function(e,t){var a={name:"TreantJS Extension",none:"none",settingsKey:"treantjs",configPopup:{url:"config",size:{height:500,width:400}},ids:{treeContainer:"tree-container"},colors:{background:"white"},defaults:{data:{worksheet:"",nodeId:"",nodeLabel:"",parentId:"",color:"none"},action:{enabled:!1,field:"",parameter:""},formatting:{rootNodeOrientation:"WEST",verticalAlignment:"TOP",levelsToShow:2}}};e.exports=a},54:function(e,t,a){},55:function(e,t,a){},59:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(23),i=a.n(r),s=a(25),l=a(9),c=a(10),u=a.n(c),d=a(13),m=a(14),f=a(15),h=a(7),g=a(16),p=a(17),b=a(3),v=a.n(b),E=a(8),k=a.n(E),y=a(24),w=a.n(y);a(54);var N=function(e){return o.a.createElement("div",{className:"loadingIndicator"},o.a.createElement("h3",null,e.msg),o.a.createElement(w.a,{name:"three-bounce",fadeIn:"none"}))},S=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={settings:v.a.defaults,myChart:null,isLoading:!0},n.resize=n.resize.bind(Object(h.a)(n)),n.onComplete=n.onComplete.bind(Object(h.a)(n)),n.onClick=n.onClick.bind(Object(h.a)(n)),n}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this;function t(e,a,n){a<n&&e.forEach((function(e){e.collapsed=!1,e.children&&t(e.children,a+1,n)}))}function a(){return(a=Object(d.a)(u.a.mark((function a(i){var s,l,c,d;return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n(i.data.worksheet);case 2:s=a.sent,(l=o(s,i)).collapsed=!1,i.formatting.levelsToShow>2&&t(l.children,2,i.formatting.levelsToShow),c={nodeStructure:l,chart:{container:k.a.getSelectorById(v.a.ids.treeContainer),rootOrientation:i.formatting.rootNodeOrientation,nodeAlign:i.formatting.verticalAlignment,levelSeparation:30,siblingSeparation:30,subTreeSeparation:30,hideRootNode:!1,animateOnInit:!1,animateOnInitDelay:500,scrollbar:"native",padding:15,connectors:{type:"step",stackIndent:15},node:{collapsable:!0,HTMLclass:"nodeExample1",target:"_self"},callback:{onAfterClickCollapseSwitch:e.onClick,onTreeLoaded:e.onComplete}}},r(),d=new Treant(c),e.setState({myChart:d,settings:i,isLoading:!1});case 10:case"end":return a.stop()}}),a)})))).apply(this,arguments)}function n(e){var t=tableau.extensions.dashboardContent.dashboard.worksheets.filter((function(t){return t.name===e}));return 1===t.length?t[0].getSummaryDataAsync().then((function(e){return e})):null}function o(e,t){if(e){var a=[];e.data.forEach((function(n){for(var o,r,i={name:""},s=0;s<n.length;s++){var l=e.columns[s].fieldName,c=!0;if(l===t.data.nodeId&&(o=n[s].formattedValue,c=!1),l===t.data.nodeLabel&&(i.name=n[s].formattedValue,c=!1),l===t.data.parentId&&(r=n[s].formattedValue,c=!1),l===t.action.field&&(i["data-parameter"]=n[s].formattedValue,c=!1),l===t.data.color){var u=k.a.colorToHex(n[s].formattedValue);i["data-bg-color"]=u.background,i["data-font-color"]=u.font,c=!1}c&&(i[l]=n[s].formattedValue)}var d={HTMLid:"tree-node-"+o,HTMLclass:"card",parentId:"NULL"===r.toUpperCase()?null:r,id:o,collapsed:!0,text:i};a.push(d)}));var n=[],o={};return a.forEach((function(e){if(!e.parentId)return n.push(e);var t=o[e.parentId];if("number"!==typeof t&&(t=a.findIndex((function(t){return t.id===e.parentId})),o[e.parentId]=t),t<0)k.a.log("Node "+e.id+" specified a parent of id "+e.parentId+", but that parent does not exist.  skipping this one.");else{if(!a[t].children)return a[t].children=[e];a[t].children.push(e)}})),n[0]}return{text:{name:"Please configure the extension, in order to view your hierarchy tree"},children:[{text:{name:"sample data 1"}},{text:{name:"sample data 2"}}]}}function r(){e.state.myChart&&e.state.myChart.destroy()}function i(){var e=tableau.extensions.settings.get(v.a.settingsKey);!function(e){a.apply(this,arguments)}(e?JSON.parse(e):v.a.defaults)}window.addEventListener("resize",e.resize),e.resize(),tableau.extensions.initializeAsync({configure:function(){var e=window.location.href+"#config";tableau.extensions.ui.displayDialogAsync(e,"",v.a.configPopup.size).then((function(e){i()})).catch((function(e){switch(e.errorCode){case tableau.ErrorCodes.DialogClosedByUser:k.a.log("Config popup was closed by user");break;default:k.a.log(e.message)}}))}}).then((function(){i(),tableau.extensions.settings.addEventListener(tableau.TableauEventType.SettingsChanged,(function(e){i()}))}))}},{key:"resize",value:function(){var e=$(k.a.getSelectorById(v.a.ids.treeContainer));$(e).css("height",window.innerHeight),$(e).css("width",window.innerWidth),this.state.myChart&&this.state.myChart.tree.redraw(),k.a.log("Resizing the tree")}},{key:"onComplete",value:function(e){$("div.node").each((function(){$(this).css("background-color",$(this).attr("data-bg-color")),$(this).css("color",$(this).attr("data-font-color"))})),k.a.log("Treant visual complete")}},{key:"onClick",value:function(e){if(this.state.settings.action.enabled){var t=$(e.parentElement).attr("data-parameter"),a=this.state.settings.action.parameter.length>0;this.state.settings.action.field.length>0&&a&&t&&tableau.extensions.dashboardContent.dashboard.findParameterAsync(this.state.settings.action.parameter).then((function(e){e&&e.changeValueAsync(t)}))}}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,function(){if(e.state.isLoading)return o.a.createElement(N,{msg:""})}(),o.a.createElement("div",{id:v.a.ids.treeContainer}))}}]),a}(o.a.Component),C=a(28),x=a(2),T=(a(55),function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={settings:v.a.defaults,dashboard:{},parameters:[],worksheets:[],fields:{},selectedTabIndex:0,selectedSheet:null},n.saveThenCloseDialog=n.saveThenCloseDialog.bind(Object(h.a)(n)),n.closeDialog=n.closeDialog.bind(Object(h.a)(n)),n}return Object(f.a)(a,[{key:"componentDidMount",value:function(){function e(e){return e.getSummaryDataAsync().then((function(e){return e.columns}))}function t(e){return e.getParametersAsync().then((function(e){return e}))}function a(){return(a=Object(d.a)(u.a.mark((function a(){var o,r,i,s,l,c;return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=tableau.extensions.settings.get(v.a.settingsKey),r=o?JSON.parse(o):v.a.defaults,i=tableau.extensions.dashboardContent.dashboard,s=[],l={},a.next=7,t(i);case 7:return c=a.sent,a.next=10,Promise.all(i.worksheets.map(function(){var t=Object(d.a)(u.a.mark((function t(a){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(a);case 2:return n=t.sent,t.abrupt("return",{worksheet:a,fields:n});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 10:a.sent.forEach((function(e,t){var a=n.isItemSelected(e.worksheet.name,r.data.worksheet,t);s.push({value:e.worksheet.name,label:e.worksheet.name,isSelected:a}),a&&(r.data.worksheet=e.worksheet.name),l[e.worksheet.name]=e.fields})),n.setState({settings:r,dashboard:i,parameters:c,worksheets:s,selectedSheet:r.data.worksheet,fields:l});case 13:case"end":return a.stop()}}),a)})))).apply(this,arguments)}var n=this;tableau.extensions.initializeDialogAsync().then((function(){return a.apply(this,arguments)}))}},{key:"isItemSelected",value:function(e,t,a){return t?e===t:0===a}},{key:"saveThenCloseDialog",value:function(){var e=this;tableau.extensions.settings.set(v.a.settingsKey,JSON.stringify(e.state.settings)),tableau.extensions.settings.saveAsync().then((function(t){e.closeDialog()}))}},{key:"closeDialog",value:function(){tableau.extensions.ui.closeDialog()}},{key:"render",value:function(){var e=this,t=o.a.createElement("div",{className:"tableau-titlebar"},o.a.createElement("span",{className:"tableau-titlebar-label"},"Configure Extension"),o.a.createElement("span",{className:"tableau-titlebar-close-button",onClick:this.closeDialog},"x")),a=function(t){var a=e.state.settings.data[t],r=a.length>0,i=e.state.fields.hasOwnProperty(e.state.selectedSheet)?e.state.fields[e.state.selectedSheet]:[],s=[];return i.forEach((function(i,l){var c=r?i.fieldName===a:0===l;s.push(o.a.createElement("option",{key:l,value:i.fieldName,selected:c},i.fieldName)),c&&!r&&n(i.fieldName,"data",t,e)})),s},n=function(e,t,a,n){var o=Object(C.a)({},n.state.settings);o[t][a]=e,n.setState({settings:o})},r={0:o.a.createElement("div",null,o.a.createElement("div",{className:"tableau-section-title"},"Where do we get the data?"),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement("span",{className:"tableau-section-label"},"Worksheet:"),o.a.createElement(x.DropdownSelect,{kind:"line",onChange:function(t){e.setState({selectedSheet:t.target.value})}},this.state.worksheets.map((function(e,t){return o.a.createElement("option",{key:t,value:e.value,selected:e.isSelected},e.label)})))),o.a.createElement("div",{className:"tableau-section-title"},"What fields do we use?"),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement("span",{className:"tableau-section-label"},"Node ID:"),o.a.createElement(x.DropdownSelect,{kind:"line",onChange:function(t){n(t.target.value,"data","nodeId",e)}},a("nodeId"))),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement("span",{className:"tableau-section-label"},"Node Labels:"),o.a.createElement(x.DropdownSelect,{kind:"line",onChange:function(t){n(t.target.value,"data","nodeLabel",e)}},a("nodeLabel"))),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement("span",{className:"tableau-section-label"},"Parent IDs:"),o.a.createElement(x.DropdownSelect,{kind:"line",onChange:function(t){n(t.target.value,"data","parentId",e)}},a("parentId"))),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement("span",{className:"tableau-section-label"},"Color (optional):"),o.a.createElement(x.DropdownSelect,{kind:"line",onChange:function(t){n(t.target.value,"data","color",e)}},o.a.createElement("option",{key:-1,value:v.a.none},"None"),a("color")))),1:o.a.createElement("div",null,o.a.createElement("div",{className:"tableau-section-title"},"Set a parameter value, on selection"),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement(x.Checkbox,{checked:this.state.settings.action.enabled,onChange:function(t){n(t.target.checked,"action","enabled",e)}}),o.a.createElement("span",{className:"tableau-section-label"},"Enabled")),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement("span",{className:"tableau-section-label"},"Parameter:"),o.a.createElement(x.DropdownSelect,{kind:"line",onChange:function(t){n(t.target.value,"action","parameter",e)}},function(){var t=e.state.settings.action.parameter,a=t.length>0,r=[];return e.state.parameters.forEach((function(i,s){var l=a?i.name===t:0===s;r.push(o.a.createElement("option",{key:s,value:i.name,selected:l},i.name)),l&&!a&&n(i.name,"action","parameter",e)})),r}())),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement("span",{className:"tableau-section-label"},"Field Value:"),o.a.createElement(x.DropdownSelect,{kind:"line",onChange:function(t){n(t.target.value,"action","field",e)}},function(){var t=e.state.settings.action.field,a=t.length>0,r=e.state.fields.hasOwnProperty(e.state.selectedSheet)?e.state.fields[e.state.selectedSheet]:[],i=[];return r.forEach((function(r,s){var l=a?r.fieldName===t:0===s;i.push(o.a.createElement("option",{key:s,value:r.fieldName,selected:l},r.fieldName)),l&&!a&&n(r.fieldName,"action","field",e)})),i}()))),2:o.a.createElement("div",null,o.a.createElement("div",{className:"tableau-section-title"},"Formatting Settings"),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement("span",{className:"tableau-section-label"},"Root Orientation:"),o.a.createElement(x.DropdownSelect,{kind:"line",onChange:function(t){n(t.target.value,"formatting","rootNodeOrientation",e)}},["NORTH","WEST","SOUTH","EAST"].map((function(t){return o.a.createElement("option",{key:t,value:t,selected:e.state.settings.formatting.rootNodeOrientation===t},t)})))),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement("span",{className:"tableau-section-label"},"Node Alignment:"),o.a.createElement(x.DropdownSelect,{kind:"line",onChange:function(t){n(t.target.value,"formatting","verticalAlignment",e)}},["CENTER","TOP","BOTTOM"].map((function(t){return o.a.createElement("option",{key:t,value:t,selected:e.state.settings.formatting.rootNodeOrientation===t},t)})))),o.a.createElement("div",{className:"tableau-section-group"},o.a.createElement("span",{className:"tableau-section-label"},"Visible Levels:"),o.a.createElement(x.Stepper,{min:2,max:10,step:1,pageSteps:1,value:this.state.settings.formatting.levelsToShow,onValueChange:function(t){return n(t,"formatting","levelsToShow",e)}})))},i=o.a.createElement("div",{className:"tableau-footer"},o.a.createElement(x.Button,{kind:"outline",key:"cancelButton",onClick:this.closeDialog},"Cancel"),o.a.createElement(x.Button,{kind:"primary",key:"saveButton",onClick:this.saveThenCloseDialog},"Save"));return o.a.createElement("div",{className:"container"},t,o.a.createElement(x.Tabs,{tabs:[{content:"Data"},{content:"Actions"},{content:"Formatting"}],selectedTabIndex:this.state.selectedTabIndex,onTabChange:function(t){e.setState({selectedTabIndex:t})}},r[this.state.selectedTabIndex]),i)}}]),a}(o.a.Component));function O(){return o.a.createElement(s.a,null,o.a.createElement(I,null))}function I(){var e=Object(l.d)();return o.a.createElement("div",null,"#config"===e.hash?o.a.createElement(T,null):o.a.createElement(S,null))}i.a.render(o.a.createElement(O,null),document.getElementById("root"))},8:function(e,t){var a={log:function(e){console.log("TreanJS Extension: "+e)},getSelectorById:function(e){return"#"+e},colorToHex:function(e){var t,a;return t=function(e){var t,a;return(t=document.createElement("canvas")).height=1,t.width=1,(a=t.getContext("2d")).fillStyle=e,a.fillRect(0,0,1,1),a.getImageData(0,0,1,1).data}(e),{background:"#"+[0,1,2].map((function(e){return("0"+t[e].toString(16)).slice(-2)})).join(""),font:(a=t,Math.round((299*parseInt(a[0])+587*parseInt(a[1])+114*parseInt(a[2]))/1e3)>125?"black":"white")}}};e.exports=a}},[[29,1,2]]]);
//# sourceMappingURL=main.e036ca12.chunk.js.map